

Given /^A path with many projects at the first and second level$/ do
  @projects_path =  File.join(File.dirname(__FILE__),'../../test/data')
  @projects_path.should match '.*/bioruby-ngs/features/step_definitions/../../test/data'
end

When /^I build the projects structure$/ do
   @projects = Bio::Ngs::Illumina.build @projects_path

   @projects.should_not be nil
end

Then /^I sould get all the projects organized in the same structure\.$/ do
	@data_json = @projects.to_json
	@fixed_json = @data_json.gsub(/\"name\":\".*?\",/,"\"name\":\"test\",").gsub(/\"........-....-....-....-............\":/,"\"retest\":")
    @fixed_json.should == <<JSON
"{\"json_class\":\"Bio::Ngs::Illumina::Projects\",\"name\":\"test\",\"pool\":{\"Cow\":{\"json_class\":\"Bio::Ngs::Illumina::Project\",\"name\":\"test\",\"sample_sheet\":null,\"samples\":{\"SQ_0007\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0007\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"filtered/SQ_0007_CGATGT_L003_R1_001.fastq.gz\",\"filtered\":true,\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"filtered/SQ_0007_CGATGT_L003_R1_002.fastq.gz\",\"filtered\":true,\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"filtered/SQ_0007_CGATGT_L003_R2_001.fastq.gz\",\"filtered\":true,\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"filtered/SQ_0007_CGATGT_L003_R2_002.fastq.gz\",\"filtered\":true,\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0007_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0007_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0007_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0007_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"trimmed/SQ_0007_CGATGT_L003_R1_TRIMMED.fastq.gz\",\"trimmed\":true,\"trimmed_aggregated\":true,\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"trimmed/SQ_0007_CGATGT_L003_R2_TRIMMED.fastq.gz\",\"trimmed\":true,\"trimmed_aggregated\":true,\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\"}}}},\"SQ_0008\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0008\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0008_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0008_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0008_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0008_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}},\"SQ_0009\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0009\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0009_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0009_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0009_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0009_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}}}},\"Dog\":{\"json_class\":\"Bio::Ngs::Illumina::Project\",\"name\":\"test\",\"sample_sheet\":null,\"samples\":{\"SQ_0004\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0004\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0004_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0004_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0004_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0004_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}},\"SQ_0005\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0005\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0005_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0005_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0005_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0005_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}},\"SQ_0006\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0006\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0006_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0006_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0006_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0006_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}}}},\"Human\":{\"json_class\":\"Bio::Ngs::Illumina::Project\",\"name\":\"test\",\"sample_sheet\":null,\"samples\":{\"SQ_0001\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0001\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0001_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0001_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0001_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0001_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}},\"SQ_0002\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0002\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0002_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0002_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0002_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0002_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}},\"SQ_0003\":{\"json_class\":\"Bio::Ngs::Illumina::Sample\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"path\":\"Sample_SQ_0003\"},\"files\":{\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0003_CGATGT_L003_R1_001.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0003_CGATGT_L003_R1_002.fastq.gz\",\"left\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0003_CGATGT_L003_R2_001.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"001\"}},\"retest\":{\"json_class\":\"Bio::Ngs::Illumina::MetaReads\",\"name\":\"test\",\"metadata\":{\"name\":\"test\",\"filename\":\"SQ_0003_CGATGT_L003_R2_002.fastq.gz\",\"right\":true,\"zipped\":true,\"index\":\"CGATGT\",\"lane\":\"003\",\"chunks\":\"002\"}}}}}}}}"
JSON
end